import{j as e,u as v,r as f}from"./index-BXQqOrT8.js";import{S as h}from"./sweetalert2.esm.all-O8mKH-HY.js";const N=async(a,m,n)=>{if((await h.fire({title:"¿Estás seguro?",text:`Vas a eliminar: ${m}`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{if(await n(a))h.fire("Eliminado","El producto ha sido borrado de la base de datos.","success");else throw new Error("Error en el backend")}catch(r){console.error(r),h.fire("Error","No se pudo eliminar el producto.","error")}},S=({producto:a})=>a?e.jsxs("div",{style:{padding:"20px",color:"#000"},children:[e.jsx("h2",{style:{fontSize:"2rem",marginBottom:"10px"},children:a.nombre}),e.jsx("img",{src:a.imagen||"https://via.placeholder.com/300?text=Sin+Imagen",alt:a.nombre||"Producto",style:{width:"100%",maxWidth:"300px",borderRadius:"10px",marginBottom:"20px",objectFit:"cover"},onError:m=>{m.target.src="https://via.placeholder.com/300?text=Error+Imagen"}}),e.jsxs("p",{children:[e.jsx("strong",{children:"ID Ref:"})," ",a.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Categoría:"})," ",a.categoria]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Precio:"})," ",e.jsxs("span",{style:{color:"green",fontWeight:"bold"},children:[a.precio," €"]})]}),e.jsx("p",{style:{marginTop:"15px"},children:e.jsx("strong",{children:"Descripción Técnica:"})}),e.jsx("p",{children:a.descripcion||"Sin descripción disponible."})]}):null,P=({productos:a,onClose:m})=>{const{editarProducto:n}=v(),l=a,[r,x]=f.useState({nombre:l.nombre||"",precio:l.precio||"",imagen:l.imagen||"",categoria:l.categoria||"",descripcion:l.descripcion||""}),[o,g]=f.useState({}),p=t=>{x({...r,[t.target.name]:t.target.value}),o[t.target.name]&&g({...o,[t.target.name]:null})},c=()=>{const t={},{nombre:u,precio:i,imagen:b,categoria:j,descripcion:E}=r;u.trim()||(t.nombre="El nombre es obligatorio."),b.trim()||(t.imagen="La URL de la imagen es obligatoria."),j.trim()||(t.categoria="La categoría es obligatoria."),E.trim()||(t.descripcion="La descripción es obligatoria.");const C=parseFloat(i);return(!i||isNaN(C)||C<=0)&&(t.precio="Introduce un precio numérico mayor a 0."),t},d=async t=>{t.preventDefault();const u=c();if(Object.keys(u).length>0){g(u);return}const i=parseFloat(r.precio),b={id:l.id,nombre:r.nombre.trim(),precio:i,imagen:r.imagen.trim(),categoria:r.categoria.trim(),descripcion:r.descripcion.trim(),ocasion:l.ocasion,porcentaje:l.porcentaje};try{if(await n(b))h.fire({icon:"success",title:"Actualizado",text:"Producto modificado correctamente en la base de datos",timer:1500,showConfirmButton:!1}),m();else throw new Error("Fallo al actualizar en el backend")}catch(j){console.error(j),h.fire("Error","Error al conectar con el servidor Java","error")}},s={color:"red",fontSize:"0.85rem",marginTop:"5px",display:"block"};return e.jsxs("div",{className:"form-container",children:[e.jsxs("h2",{children:["Editar: ",l.nombre]}),e.jsxs("form",{onSubmit:d,noValidate:!0,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nombre:"}),e.jsx("input",{type:"text",name:"nombre",value:r.nombre,onChange:p,style:o.nombre?{borderColor:"red"}:{}}),o.nombre&&e.jsx("span",{style:s,children:o.nombre})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Precio (€):"}),e.jsx("input",{type:"number",name:"precio",value:r.precio,onChange:p,style:o.precio?{borderColor:"red"}:{}}),o.precio&&e.jsx("span",{style:s,children:o.precio})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Imagen URL:"}),e.jsx("input",{type:"text",name:"imagen",value:r.imagen,onChange:p,style:o.imagen?{borderColor:"red"}:{}}),o.imagen&&e.jsx("span",{style:s,children:o.imagen})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Categoría:"}),e.jsx("input",{type:"text",name:"categoria",value:r.categoria,onChange:p,style:o.categoria?{borderColor:"red"}:{}}),o.categoria&&e.jsx("span",{style:s,children:o.categoria})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Descripción:"}),e.jsx("textarea",{name:"descripcion",value:r.descripcion,onChange:p,rows:"4",style:o.descripcion?{borderColor:"red"}:{}}),o.descripcion&&e.jsx("span",{style:s,children:o.descripcion})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-save",children:"Actualizar"}),e.jsx("button",{type:"button",className:"btn-cancel",onClick:m,children:"Cancelar"})]})]})]})},A=({onClose:a})=>{const{crearProducto:m}=v(),[n,l]=f.useState({nombre:"",precio:"",imagen:"",categoria:"Bicicleta de Montaña",descripcion:""}),[r,x]=f.useState({}),o=d=>{const{name:s,value:t}=d.target;l({...n,[s]:t}),r[s]&&x({...r,[s]:null})},g=()=>{let d={};n.nombre.trim()||(d.nombre="El nombre es obligatorio."),n.imagen.trim()||(d.imagen="La URL de la imagen es obligatoria."),n.categoria.trim()||(d.categoria="La categoría es obligatoria."),n.descripcion.trim()||(d.descripcion="La descripción es obligatoria.");const s=parseFloat(n.precio);return(!n.precio||isNaN(s)||s<=0)&&(d.precio="El precio debe ser un número mayor a 0."),d},p=async d=>{d.preventDefault();const s=g();if(Object.keys(s).length>0){x(s);return}const t={nombre:n.nombre.trim(),precio:parseFloat(n.precio),imagen:n.imagen.trim(),categoria:n.categoria.trim(),descripcion:n.descripcion.trim(),ocasion:!1,porcentaje:0};try{if(await m(t))h.fire({icon:"success",title:"Producto guardado en MySQL",showConfirmButton:!1,timer:1500}),a();else throw new Error("Error al guardar en el backend")}catch(u){console.error("Error:",u),h.fire("Error","No se pudo conectar con el servidor Java","error")}},c={color:"red",fontSize:"12px",marginTop:"4px",display:"block"};return e.jsxs("div",{className:"form-container",children:[e.jsx("h2",{children:"Nuevo Producto (MySQL)"}),e.jsxs("form",{onSubmit:p,noValidate:!0,children:[e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("input",{type:"text",name:"nombre",placeholder:"Nombre Modelo",onChange:o,value:n.nombre,style:r.nombre?{borderColor:"red"}:{}}),r.nombre&&e.jsx("span",{style:c,children:r.nombre})]}),e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("input",{type:"number",name:"precio",placeholder:"Precio (€)",onChange:o,value:n.precio,style:r.precio?{borderColor:"red"}:{}}),r.precio&&e.jsx("span",{style:c,children:r.precio})]}),e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("input",{type:"text",name:"imagen",placeholder:"URL de la imagen",onChange:o,value:n.imagen,style:r.imagen?{borderColor:"red"}:{}}),r.imagen&&e.jsx("span",{style:c,children:r.imagen})]}),e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("input",{type:"text",name:"categoria",placeholder:"Categoría",value:n.categoria,onChange:o,style:r.categoria?{borderColor:"red"}:{}}),r.categoria&&e.jsx("span",{style:c,children:r.categoria})]}),e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("textarea",{name:"descripcion",placeholder:"Descripción técnica",onChange:o,value:n.descripcion,style:r.descripcion?{borderColor:"red"}:{}}),r.descripcion&&e.jsx("span",{style:c,children:r.descripcion})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-save",children:"Guardar en Base de Datos"}),e.jsx("button",{type:"button",className:"btn-cancel",onClick:a,children:"Cancelar"})]})]})]})},y=({isOpen:a,onClose:m,children:n})=>a?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{className:"close-btn",onClick:m,children:"X"}),n]})}):null;function L(){console.log("Estas dentro de administracion");const{productos:a,loading:m,eliminarProducto:n,cargarProductos:l}=v(),r=Array.isArray(a)?a:[],[x,o]=f.useState(null),[g,p]=f.useState({crear:!1,consultar:!1,editar:!1}),c=(i,b)=>{p(j=>({...j,[i]:b})),!b&&(i==="crear"||i==="editar")&&l()},d=i=>{o(i),c("consultar",!0)},s=i=>{o(i),c("editar",!0)},t=()=>{c("crear",!0)},u=i=>{N(i.id,i.nombre,n)};return m?e.jsx("div",{style:{textAlign:"center",marginTop:"100px",color:"var(--text-color)"},children:"CARGANDO PRODUCTOS DE MYSQL..."}):e.jsxs("div",{className:"admin-container",children:[e.jsx("h1",{style:{textAlign:"center",fontFamily:"Poppins",fontWeight:"900",fontSize:"2.5rem",marginBottom:"40px",color:"var(--text-color)"},children:"PANEL DE CONTROL"}),e.jsx("ul",{className:"productos-list",children:r.length>0?r.map(i=>e.jsxs("li",{className:"producto-item",children:[e.jsxs("div",{className:"producto-item-header",children:[e.jsx("strong",{children:i.nombre}),e.jsxs("span",{className:"producto-info-extra",children:[i.categoria," // ",Number(i.precio).toLocaleString("de-DE")," €"]})]}),e.jsxs("div",{className:"producto-item-actions",children:[e.jsx("button",{onClick:()=>d(i),children:"VER"}),e.jsx("button",{onClick:()=>u(i),children:"ELIMINAR"}),e.jsx("button",{onClick:()=>s(i),children:"EDITAR"})]})]},i.id)):e.jsx("p",{style:{textAlign:"center",color:"var(--text-color)"},children:"NO HAY DATOS EN LA BASE DE DATOS."})}),e.jsx("button",{className:"add-producto-btn",onClick:t,children:"+ NUEVA REFERENCIA"}),e.jsx(y,{isOpen:g.crear,onClose:()=>c("crear",!1),children:e.jsx(A,{onClose:()=>c("crear",!1)})}),e.jsx(y,{isOpen:g.consultar,onClose:()=>c("consultar",!1),children:x&&e.jsx(S,{producto:x})}),e.jsx(y,{isOpen:g.editar,onClose:()=>c("editar",!1),children:e.jsx(P,{productos:x,onClose:()=>c("editar",!1)})})]})}export{L as default};
